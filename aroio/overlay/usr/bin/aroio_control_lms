#!/bin/sh

. /boot/userconfig.txt

[ "$SERVERNAME" = "" ] && LMS_ADDRESS=$(netstat -n | grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}:3483\b" | grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}") || LMS_ADDR="$SERVERNAME"
LMS_AUTH="$AUTH"
[ "$SERVERPORT" = "" ] && LMS_PORT="9000" || LMS_PORT="$SERVERPORT"
MAC_ADDRESS=$(cat /sys/class/net/eth0/address)


echo "http://"$LMS_AUTH""$LMS_ADDRESS":"$LMS_PORT"/status.txt?p0=pause&player=$MAC_ADDRESS"

# calling status.txt leads to a 404 error but works and is much quicker than loading status.html
case $1 in
	pause|play)	wget -O /dev/null -q "http://"$LMS_AUTH""$LMS_ADDRESS":"$LMS_PORT"/status.txt?p0=pause&player=$MAC_ADDRESS"
	;;

	stop)		wget -O /dev/null -q "http://"$LMS_AUTH""$LMS_ADDRESS":"$LMS_PORT"/status.txt?p0=stop&player=$MAC_ADDRESS"
	;;

	next)		wget -O /dev/null -q "http://"$LMS_AUTH""$LMS_ADDRESS":"$LMS_PORT"/status.txt?p0=button&p1=jump_fwd&player=$MAC_ADDRESS"
	;;

	previous)	wget -O /dev/null -q "http://"$LMS_AUTH""$LMS_ADDRESS":"$LMS_PORT"/status.txt?p0=button&p1=jump_rew&player=$MAC_ADDRESS"
	;;
esac
