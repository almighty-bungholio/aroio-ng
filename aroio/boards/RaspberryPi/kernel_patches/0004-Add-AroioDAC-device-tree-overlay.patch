From 51fb593da5fb8657fde3b678ef13b8c6d4c68427 Mon Sep 17 00:00:00 2001
From: Arne Caspari <arne@unicap-imaging.org>
Date: Mon, 4 Feb 2019 09:55:08 +0100
Subject: [PATCH 4/4] Add AroioDAC device tree overlay

---
 arch/arm/boot/dts/overlays/Makefile           |  1 +
 .../boot/dts/overlays/aroiodac-overlay.dts    | 72 +++++++++++++++++++
 2 files changed, 73 insertions(+)
 create mode 100644 arch/arm/boot/dts/overlays/aroiodac-overlay.dts

diff --git a/arch/arm/boot/dts/overlays/Makefile b/arch/arm/boot/dts/overlays/Makefile
index 7cdd0195e7eb..aba2efd7c194 100644
--- a/arch/arm/boot/dts/overlays/Makefile
+++ b/arch/arm/boot/dts/overlays/Makefile
@@ -15,6 +15,7 @@ dtbo-$(CONFIG_ARCH_BCM2835) += \
 	allo-piano-dac-pcm512x-audio.dtbo \
 	allo-piano-dac-plus-pcm512x-audio.dtbo \
 	applepi-dac.dtbo \
+	aroiodac.dtbo \
 	at86rf233.dtbo \
 	audioinjector-addons.dtbo \
 	audioinjector-ultra.dtbo \
diff --git a/arch/arm/boot/dts/overlays/aroiodac-overlay.dts b/arch/arm/boot/dts/overlays/aroiodac-overlay.dts
new file mode 100644
index 000000000000..548aefbd4914
--- /dev/null
+++ b/arch/arm/boot/dts/overlays/aroiodac-overlay.dts
@@ -0,0 +1,72 @@
+// Definitions for HiFiBerry DAC+ADC
+/dts-v1/;
+/plugin/;
+
+/ {
+	compatible = "brcm,bcm2708";
+
+	fragment@0 {
+		target-path = "/clocks";
+		__overlay__ {
+			aroiodac_osc: aroiodac_osc {
+				compatible = "abacus,aroiodac-clk";
+				#clock-cells = <0>;
+			};
+		};
+	};
+
+	fragment@1 {
+		target = <&i2s>;
+		__overlay__ {
+			status = "okay";
+		};
+	};
+
+	fragment@2 {
+		target = <&i2c1>;
+		__overlay__ {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			status = "okay";
+
+			pcm_codec: pcm5122@4d {
+				#sound-dai-cells = <0>;
+				compatible = "ti,pcm5122";
+				reg = <0x4d>;
+				clocks = <&aroiodac_osc>;
+				AVDD-supply = <&vdd_3v3_reg>;
+				DVDD-supply = <&vdd_3v3_reg>;
+				CPVDD-supply = <&vdd_3v3_reg>;
+				status = "okay";
+			};
+		};
+	};
+
+	fragment@3 {
+		target-path = "/";
+		__overlay__ {
+			src4382_codec: src4382 {
+				#sound-dai-cells = <0>;
+				compatible = "ti,src4382";
+				num-channels = <2>;
+				status = "okay";
+			};
+		};
+	};
+
+	fragment@4 {
+		target = <&sound>;
+		hifiberry_dacplusadc: __overlay__ {
+			compatible = "abacus,aroiodac";
+			i2s-controller = <&i2s>;
+            src-addr = <0x70>;
+			status = "okay";
+		};
+	};
+
+	__overrides__ {
+		24db_digital_gain =
+			<&hifiberry_dacplusadc>,"hifiberry,24db_digital_gain?";
+		slave = <&hifiberry_dacplusadc>,"hifiberry-dacplusadc,slave?";
+	};
+};
-- 
2.20.1

